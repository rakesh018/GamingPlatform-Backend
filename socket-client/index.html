<!DOCTYPE html>
<html>
<head>
  <title>Socket.io Test</title>
  <script src="http://localhost:3000/socket.io/socket.io.js"></script>
</head>
<body>
  <h1>Socket.io Client</h1>
  <p>Open the console to see the logs.</p>

  <h2>Coin Flip</h2>
  <input type="number" id="betAmount1" placeholder="Enter bet amount">
  <select id="betChoice1">
    <option value="head">Head</option>
    <option value="tail">Tail</option>
  </select>
  <button onclick="startGame('coinFlip', 1)">Round 1 (1 minute)</button>
  <button onclick="startGame('coinFlip', 3)">Round 2 (3 minutes)</button>
  <button onclick="startGame('coinFlip', 5)">Round 3 (5 minutes)</button>
  <button onclick="startGame('coinFlip', 10)">Round 4 (10 minutes)</button>
  <div id="timercoinFlip1"></div>
  <div id="timercoinFlip3"></div>
  <div id="timercoinFlip5"></div>
  <div id="timercoinFlip10"></div>

  <h2>Stock Trader</h2>
  <input type="number" id="betAmount2" placeholder="Enter bet amount">
  <select id="betChoice2">
    <option value="up">Up</option>
    <option value="down">Down</option>
  </select>
  <button onclick="startGame('stockTrader', 1)">Round 1 (1 minute)</button>
  <button onclick="startGame('stockTrader', 3)">Round 2 (3 minutes)</button>
  <button onclick="startGame('stockTrader', 5)">Round 3 (5 minutes)</button>
  <button onclick="startGame('stockTrader', 10)">Round 4 (10 minutes)</button>
  <div id="timerstockTrader1"></div>
  <div id="timerstockTrader3"></div>
  <div id="timerstockTrader5"></div>
  <div id="timerstockTrader10"></div>

  <script>
    const token = localStorage.getItem('token');
    const socket = io('http://localhost:3000', {
      auth: {
        token: `Bearer ${token}`
      }
    });

    socket.on('connect', () => {
      console.log('Connected to socket server');
    });

    socket.on('MESSAGE', (msg) => {
      console.log('Received message:', msg);
    });

    socket.emit('clientMessage', 'Hello from client!');

    socket.on('disconnect', () => {
      console.log('Disconnected from server');
    });

    socket.on('timerUpdate', (data) => {
      const { gameName, roundDuration, newTimer } = data;
      const timerElement = document.getElementById(`timer${gameName}${roundDuration}`);
      timerElement.innerHTML = `Round (${roundDuration} minutes): ${newTimer} remaining`;
    });

    socket.on('timerEnd', (data) => {
      const { gameName, roundDuration, duration } = data;
      const timerElement = document.getElementById(`timer${gameName}${roundDuration}`);
      timerElement.innerHTML = `Round (${roundDuration} minutes) of ${gameName} has ended. Duration was ${duration} minutes.`;
    });

    socket.on('roundFreeze', (data) => {
      const { gameName, roundDuration } = data;
      const timerElement = document.getElementById(`timer${gameName}${roundDuration}`);
      timerElement.innerHTML = `Round (${roundDuration} minutes): Round Freeze!`;
    });

    async function startGame(gameName, roundDuration) {
      const betAmount = document.getElementById(`betAmount${gameName === 'coinFlip' ? 1 : 2}`).value;
      const betChoice = document.getElementById(`betChoice${gameName === 'coinFlip' ? 1 : 2}`).value;
      
      if (!betAmount || betAmount <= 0) {
        alert('Please enter a valid bet amount');
        return;
      }

      console.log(`Game: ${gameName}, Round Duration: ${roundDuration} minutes, Bet Amount: ${betAmount}, Bet Choice: ${betChoice}`);

      try {
        const response = await fetch('http://localhost:3000/bets/makeBet', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ gameName, roundDuration, betAmount, betChoice })
        });
        
        const data = await response.json();
        if (response.ok) {
          console.log('Bet placed successfully:', data);
        } else {
          console.error('Error placing bet:', data.error);
          alert(`Error placing bet: ${data.error}`);
        }
      } catch (error) {
        console.error('Network error:', error);
        alert('Network error. Please try again later.');
      }
    }
  </script>
</body>
</html>
